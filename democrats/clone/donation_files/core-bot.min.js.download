!function(a){function b(b){return-1===b.indexOf("#")?a.map(b.match(/\b(\d+)\b/g),function(a){return("0"+parseInt(a,10).toString(16)).slice(-2)}).join("").slice(0,6):b.replace("#","")}function c(b){return b.pipe(function(b){return b.error?a.Deferred().reject(b):b},function(b){return a.Deferred().reject(b)})}function d(){this.cb=a.Callbacks("unique"),this.loggedin=!1,this.data={},this.keycode=u,this.state="",this.bsdUser=!1,this.infoUpdate=a.Callbacks(),this.getGraph=function(){return c(a.ajax({url:"https://my.democrats.org/page/graph/me?callback=?&jsoncallback=?",dataType:"jsonp"}))},this.getSpud=function(){return c(a.ajax({url:"https://my.democrats.org/page/spud?type=getm&field=email,firstname,lastname,addr1,city,state_cd,zip,phone&jsonp=?",dataType:"jsonp"}))},this.getDonorHash=function(){return c(a.ajax({url:"https://hashcloud.dnc.org/people/"+this.keycode+".jsonp?callback=?",dataType:"jsonp"}))},this.normalize=function(a){var b,c={postal_code:"zip",first_name:"firstname",last_name:"lastname",address_1:"addr1",address_2:"addr2",state:"state_cd"};for(b in a)a.hasOwnProperty(b)&&c.hasOwnProperty(b)&&(a[c[b]]=a[b],delete a[b]);this.state=this.data.state_cd,cSet("dstate",this.state,365)},this.update=function(b){if(!b.error){var c,d;for(d in b)if(("NULL"===b[d]||"null"===b[d]||"Information Requested"===b[d])&&(b[d]=""),a.isArray(b[d])){for(c=b[d].length;c--;)if("undefined"!=typeof b[d][c].is_primary&&b[d][c].is_primary===!0){a.extend(this.data,b[d][c]);break}}else this.data[d]=b[d];return delete this.data.is_primary,this.data.add1&&this.data.zip&&(this.geoAddr=!0),(this.data.email&&this.data.zip||cGet("bsduser"))&&(this.bsdUser=!0,cSet("bsduser",!0,365)),this.normalize(this.data),this.infoUpdate.fire(this),this}},this.preFill=function(b,c){b=b||this,c=c||m,c.find("input, select").not('[name="amount"]').each(function(){var c=a(this),d=c.attr("name");if(d){d="from_"===d.slice(0,5)?d.slice(5):d;var e=e=decodeURIComponent(gup(d)).replace(/\+/g," ")||b.data[d]||null;e&&c.val(e).removeClass("placeholder").addClass("prefilled")}})}}function e(){dNC.flags.dnclogin=!0,user.loggedin=!0,this.bsdUser=!0,cSet("bsduser",!0,365),a(document.documentElement).addClass("dnclogin"),cjSet("flags",dNC.flags,1),a(".user-name").html(user.data.firstname)}function f(){a.ajax({url:"https://my.democrats.org/page/user/logout?jsonp=callback=?",dataType:"jsonp"}).always(function(){h()})}function g(b,c){dNC.flags[b]=c,cjSet("flags",dNC.flags,1),c?a(document.documentElement).addClass(b):a(document.documentElement).removeClass(b)}function h(){cSet("guid",null,-1),g("dnclogin",!1),user.loggedin=!1,"my"===o&&window.location.reload()}function i(){k=setInterval(function(){cGet("guid")&&cGet("guid").length>8&&cGet("PHPSESSID")&&(e(),clearInterval(k))},500)}function j(){i(),w.loadOne("fb").then(function(){FB.ui({method:"oauth",display:"popup",client_id:"123142237735444",redirect_uri:"https://my.democrats.org/ctl/Oauth2/FacebookCallback/",scope:"email,offline_access"},function(a){a&&a.id&&e()})})}window._gaq=[["_setAccount","UA-70251-1"],["_setDomainName","democrats.org"],["_trackPageview"]];var k,l=a(window),m=a("html"),n=a("body"),o=window.location.hostname.split(".")[0],p=window.location.href.indexOf("page/contribute")>0,q=m.find(".wrapperMain").eq(0),r=a("form"),s=gup("source")||cGet("source")||gup("fb_ref")||!1,t=gup("subsource")||gup("fb_source")||"",u=gup("keycode")||cGet("donorhash")||!1,v="undefined"!=typeof window.loadSets?window.loadSets:{widesize:["imgIn"],thinsize:["tweets","fb","twitter","pintrest","tumblr"],mobsize:["mobmenu"],socialShares:["fb","twitter"]},w={loaded:{},loadSome:function(b){a.each(v[b],function(b,c){w[c]&&!w.loaded[c]&&(w[c].nosave||(w.loaded[c]=!0),a.isFunction(w[c])?w[c]():(!w[c].test||w[c].test())&&(w[c].prep&&w[c].prep(),w[c].complete&&(w[c].yep.complete=w[c].complete),yepnope(w[c].yep)))}),v[b]=!1},loadOne:function(b){var c=a.Deferred();return w[b]&&!w.loaded[b]?(w[b].nosave||(w.loaded[b]=!0),a.isFunction(w[b])?(w[b](),c.resolve()):!w[b].test||w[b].test()?(w[b].prep&&w[b].prep(),w[b].yep.complete=function(){w[b].complete&&w[b].complete(),!w[b].ok||w[b].ok()?c.resolve():c.reject()},yepnope(w[b].yep),c.promise()):c.reject()):c.resolve()},imgIn:function(){a(".imgIn").each(function(c,d){d=a(d);var e,f,g,h,i;d.data("imgsrc")?(i=a("<img/>",{src:d.data("imgsrc"),style:d.attr("style")||"","class":d.attr("class")+" loaded",id:d.attr("id")||""}),d.replaceWith(i)):d.is(":header,button,span,a")?(e=d.html(),f=d.css("color"),g=d.width(),h=d.css("font-size").replace("px","")-5,d.html('<img src="'+(d.data("txtimgsrc")||imggen+encodeURIComponent(d.css("text-transform").indexOf("upper")>-1?e.toUpperCase():e)+"&size="+h+(f?"&color="+b(f):"")+"&mwidth="+(d.data("mwidth")||g)+(d.data("lnsp")?"&lnsp="+d.data("lnsp"):"")+(d.data("font")?"&font="+d.data("font"):""))+'"><span>'+e+"</span>").css("min-height",h-5).addClass("imgOn")):d.data("bgimg")&&d.css("background-image",d.data("bgimg"))}).removeClass("imgIn")},flexvids:{test:function(){return!!a("iframe[src*=youtube], iframe[src*=vimeo]").length},nosave:!0,yep:{test:function(){return!!a("iframe[src*=youtube], iframe[src*=vimeo]").length},yep:dNC.cdn+"js/utils/jquery.fitvids.min.js"},complete:function(){a("iframe[src*=youtube], iframe[src*=vimeo]").not(".flexed").addClass("flexed").wrap('<div class="fitvid" />'),a().fitVids&&a(".fitvid").not(".flexed").addClass("flexed").fitVids()}},mobmenu:function(){a("#menu-toggle").on("click",function(a){a.preventDefault(),m.toggleClass("mobnav")})},events:{test:function(){return a(".eventFeed").length>0},yep:{test:"undefined"==typeof ich,yep:dNC.cdn+"js/utils/ICanHaz-comp.js",both:dNC.cdn+"js/eventGet.js"},complete:function(){eventGet.getAll()}},pintrest:{nosave:!0,test:function(){return!p&&!!q.find(".pinT").length},prep:function(){var b=q.find(".pinT");b.each(function(){var b=a(this),c=encodeURIComponent(b.closest("article").data("href")),d=b.find("img"),e=encodeURIComponent(d.attr("src")),f=encodeURIComponent(b.find("figcaption").text()||d.attr("alt")||"");b.append('<div class="pintrest barely"><a href="http://pinterest.com/pin/create/button/?url='+c+"%3Fsource%3Dpintrest&amp;media="+e+"&amp;description="+f+'" class="pin-it-button" count-layout="horizontal">Pin It</a></div>')}).removeClass("pinT"),w.loaded.pintrest=!1},yep:"//assets.pinterest.com/js/pinit.js?"},tumblr:function(){var b=q.find(".tmbT");b.each(function(){var b=a(this),c=encodeURIComponent(b.closest("article").data("href")),d=b.find("img"),e=encodeURIComponent(d.attr("src")),f=encodeURIComponent(b.find("figcaption").text()||d.attr("alt")||"");b.append('<a href="http://www.tumblr.com/share/photo?source='+e+"&amp;caption="+f+"&amp;click_thru="+c+'%3Fsource%3Dtumblr" title="Share on Tumblr" class="tumblrBtn popup barely" target="_blank">Share on Tumblr</a>')}).removeClass("tmbT"),w.loaded.tumblr=!1},fb:{prep:function(){yepnope.addPrefix("fbid",function(a){return a.attrs={id:"facebook-jssdk"},a}),window.fbAsyncInit=function(){FB.init({appId:"123142237735444",oauth:!0,status:!0,cookie:!0,xfbml:!0}),"undefined"!=typeof FB&&(FB.getLoginStatus(function(b){window.fbLoggedIn=b.authResponse,window.dNC&&window.fbLoggedIn&&(g("fblogin",!0),a(".fb-connect-status").html("connected"))}),FB.Event.subscribe("edge.create",function(a){_gaq.push(["_trackSocial","facebook","liked",a]),_gaq.push(["_trackEvent","facebook","liked",a])}),FB.Event.subscribe("edge.remove",function(a){_gaq.push(["_trackSocial","facebook","UNliked",a]),_gaq.push(["_trackEvent","facebook","UNliked",a])}))}},yep:{load:"fbid!//connect.facebook.net/en_US/all.js"}},twitter:{yep:{load:"//platform.twitter.com/widgets.js"},complete:function(){window.twttr&&(twttr.events.bind("tweet",function(a){_gaq.push(["_trackSocial","twitter","tweetshared",a.target.title]),_gaq.push(["_trackEvent","twitter","tweetshared",a.target.title])}),twttr.events.bind("follow",function(a){_gaq.push(["_trackSocial","twitter","followed",a.data.screen_name]),_gaq.push(["_trackEvent","twitter","followed",a.data.screen_name])}),twttr.events.bind("retweet",function(a){_gaq.push(["_trackSocial","twitter","retweeted","http://twitter.com/intent/tweet?in_reply_to="+a.data.source_tweet_id]),_gaq.push(["_trackEvent","twitter","retweeted","http://twitter.com/intent/tweet?in_reply_to="+a.data.source_tweet_id])}))}}};window.loader=w,s&&cSet("source",s,1),gup("keycode")&&cSet("donorhash",u,3),window.user=new d,a(".logoutBtn").on("click",function(a){a.preventDefault(),f()}),a(".fbloginBtn").on("click",function(a){a.preventDefault(),j()}),"my"!==o&&(u?user.getDonorHash(u).then(function(a){user.update(a).preFill(),cGet("guid")&&user.getGraph().then(function(a){user.update(a),e()})}):cGet("guid")?user.getGraph().then(function(a){user.update(a).preFill(),e()},function(){h()}):user.getSpud().then(function(a){user.update(a).preFill()})),r&&s&&r.each(function(){var b=a(this),c=b.attr("action")||"",d=b.find('input[name="source_codes"]')?b.find('input[name="source_codes"]'):a('<input type="hidden" name="source_codes" />').appendTo(b);-1===c.indexOf("source")&&"www"===o&&b.attr("action",c+(c.indexOf("?")>-1?"&":"?")+"source="+s+"&subsource="+t),d.val(d.val()?d.val()+","+s:s)}),q.on("click",".popup",function(b){b.preventDefault();var c=a(this);window.open(c.attr("href"),"share","height=420,width=480,fulscreen=no,location=yes,statusbar=no,toolbar=no,resizeable=yes",!1)}),yepnope({test:Modernizr.input.placeholder,nope:dNC.cdn+"js/polyfills/jquery.placeholder.min.js",callback:function(){m.addClass("placeholder-polyfilled"),a().placeholder&&a("input, textarea").placeholder()}}),Modernizr.touch&&a("#navbar").on("click",".sub",function(){a(this).toggleClass("hover"),a(".sub").removeClass("hover")}),yepnope(("https:"===document.location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js"),n.on("click",".shareEM",function(){var b=a(this);_gaq.push(["_trackEvent",b.data("type"),"emailshared",b.data("slug")])}),w.loadOne("flexvids").then(function(){}),l.on("resize.watch",function(){var a=l.width();a>767&&w.loadSome("widesize"),a>479&&w.loadSome("thinsize"),(768>a||Modernizr.touch)&&w.loadSome("mobsize"),v.mobsize||v.thinsize||v.widesize||l.off("resize.watch")}).trigger("resize.watch"),v.allsize&&w.loadSome("allsize"),a(".quick-signup a").click(function(b){b.preventDefault(),a(this).parent().toggleClass("on")});var x=a("form").find("ol");x.each(function(){var b=a(this).children("li"),c=b.length-1;b.each(function(b,d){d=a(this),d.addClass(b%2===0?"odd":"even"),0===b&&d.addClass("first-child"),b===c&&d.addClass("last-child")})}),a(".container").children(".row").last().addClass("last-row").end().each(function(){a(this).children(".column").last().addClass("omega")})}(jQuery);
